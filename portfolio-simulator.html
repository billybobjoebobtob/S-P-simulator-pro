<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&P 500 Portfolio Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.7.0/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
    <style>
        /* ... (previous styles remain largely the same) ... */
        .news-feed {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .news-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .news-item:last-child {
            border-bottom: none;
        }
        .social-share {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .social-share button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .leaderboard {
            margin-top: 20px;
        }
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
    </style>
</head>
<body>
    <!-- ... (header and main structure remain the same) ... -->
    
    <div class="container">
        <div class="main-content">
            <div class="chart-container">
                <!-- ... (chart content remains the same) ... -->
            </div>
            <div class="sidebar">
                <!-- ... (previous widgets remain) ... -->
                <div class="widget">
                    <h2>Portfolio Composition</h2>
                    <div id="portfolioComposition"></div>
                </div>
                <div class="widget">
                    <h2>News Feed</h2>
                    <div class="news-feed" id="newsFeed"></div>
                </div>
                <div class="widget">
                    <h2>Social Share</h2>
                    <div class="social-share">
                        <button onclick="shareToTwitter()"><i class="fab fa-twitter"></i> Twitter</button>
                        <button onclick="shareToFacebook()"><i class="fab fa-facebook"></i> Facebook</button>
                    </div>
                </div>
                <div class="widget">
                    <h2>Leaderboard</h2>
                    <div class="leaderboard" id="leaderboard"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ... (previous JavaScript code remains) ...

        // Portfolio Diversification
        let portfolio = {
            'SPY': 0.6,
            'AAPL': 0.2,
            'GOOGL': 0.2
        };

        function updatePortfolioComposition() {
            const compositionDiv = document.getElementById('portfolioComposition');
            compositionDiv.innerHTML = '';
            for (let stock in portfolio) {
                compositionDiv.innerHTML += `<div>${stock}: ${portfolio[stock] * 100}%</div>`;
            }
        }

        updatePortfolioComposition();

        // Performance Comparison
        function comparePerformance() {
            // Simulated data - in a real app, this would fetch actual performance data
            const portfolioPerformance = 0.15; // 15% return
            const indexPerformance = 0.12; // 12% return
            
            return {
                portfolio: portfolioPerformance,
                index: indexPerformance
            };
        }

        // News Feed
        function updateNewsFeed() {
            const newsFeed = document.getElementById('newsFeed');
            // Simulated news - in a real app, this would fetch actual news
            const news = [
                { title: "S&P 500 reaches new high", date: "2024-09-15" },
                { title: "Tech stocks surge on AI advancements", date: "2024-09-14" },
                { title: "Federal Reserve announces interest rate decision", date: "2024-09-13" }
            ];
            
            newsFeed.innerHTML = news.map(item => `
                <div class="news-item">
                    <h4>${item.title}</h4>
                    <small>${item.date}</small>
                </div>
            `).join('');
        }

        updateNewsFeed();

        // Social Sharing
        function shareToTwitter() {
            const text = `Check out my portfolio performance on S&P 500 Simulator! I'm up ${changePercent}%!`;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
        }

        function shareToFacebook() {
            const url = window.location.href;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        }

        // Gamification
        function updateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            // Simulated leaderboard data
            const leaders = [
                { name: "Alice", points: 1000 },
                { name: "Bob", points: 950 },
                { name: "Charlie", points: 900 }
            ];
            
            leaderboard.innerHTML = leaders.map((leader, index) => `
                <div class="leaderboard-item">
                    <span>${index + 1}. ${leader.name}</span>
                    <span>${leader.points} pts</span>
                </div>
            `).join('');
        }

        updateLeaderboard();

        // Error Handling
        function handleError(error) {
            console.error('An error occurred:', error);
            document.getElementById('errorMessage').textContent = 'An error occurred. Please try again later.';
            document.getElementById('errorMessage').style.display = 'block';
        }

        // ... (rest of the JavaScript code) ...
    </script>
</body>
</html>
